#!/bin/bash

# Build script for secure stock-nse-india fork
set -e

echo "ğŸ”§ Building secure stock-nse-india fork..."

# Build the Docker image
echo "ğŸ“¦ Building Docker image..."
docker build -f Dockerfile.secure -t vercelink/stock-nse-india-secure:latest .

echo "ğŸ§ª Testing the build..."
# Test that the package can be imported
docker run --rm vercelink/stock-nse-india-secure:latest node -e "
const { NseIndia } = require('./build/index.js');
const nse = new NseIndia();
console.log('âœ… Package imports successfully');
console.log('âœ… NseIndia class instantiated');
"

echo "ğŸ” Checking axios version..."
docker run --rm vercelink/stock-nse-india-secure:latest npm ls axios

echo "ğŸ‰ Build completed successfully!"
echo "ğŸ“‹ Next steps:"
echo "   1. Test the package with your application"
echo "   2. Publish to npm registry if needed"
echo "   3. Update your project to use the secure version"
