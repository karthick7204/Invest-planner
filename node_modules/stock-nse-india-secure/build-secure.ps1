# PowerShell build script for secure stock-nse-india fork
$ErrorActionPreference = "Stop"

Write-Host "ğŸ”§ Building secure stock-nse-india fork..." -ForegroundColor Green

# Build the Docker image
Write-Host "ğŸ“¦ Building Docker image..." -ForegroundColor Yellow
docker build -f Dockerfile.secure -t vercelink/stock-nse-india-secure:latest .

if ($LASTEXITCODE -ne 0) {
    Write-Host "âŒ Docker build failed!" -ForegroundColor Red
    exit 1
}

Write-Host "ğŸ§ª Testing the build..." -ForegroundColor Yellow
# Test that the package can be imported
$testCommand = @"
const { NseIndia } = require('./build/index.js');
const nse = new NseIndia();
console.log('âœ… Package imports successfully');
console.log('âœ… NseIndia class instantiated');
"@

docker run --rm vercelink/stock-nse-india-secure:latest node -e $testCommand

if ($LASTEXITCODE -ne 0) {
    Write-Host "âŒ Package test failed!" -ForegroundColor Red
    exit 1
}

Write-Host "ğŸ” Checking axios version..." -ForegroundColor Yellow
docker run --rm vercelink/stock-nse-india-secure:latest npm ls axios

Write-Host "ğŸ‰ Build completed successfully!" -ForegroundColor Green
Write-Host "ğŸ“‹ Next steps:" -ForegroundColor Cyan
Write-Host "   1. Test the package with your application" -ForegroundColor White
Write-Host "   2. Publish to npm registry if needed" -ForegroundColor White
Write-Host "   3. Update your project to use the secure version" -ForegroundColor White
